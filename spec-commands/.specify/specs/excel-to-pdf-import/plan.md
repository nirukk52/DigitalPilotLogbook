# Implementation Plan: Excel to PDF Import

**Branch**: `001-excel-to-pdf-import` | **Date**: 2026-02-03 | **Spec**: [excel-to-pdf-import.md](../excel-to-pdf-import.md)  
**Input**: Feature specification from `/specs/excel-to-pdf-import.md`

---

## Summary

Enable pilots to upload their existing TCCA Excel logbook, preview the imported flight data, and generate a TCCA-compliant PDF logbook with proper page totals and running totals. The feature will use client-side Excel parsing (xlsx library), server-side PDF generation (pdf-lib), and temporary file storage for the generated PDF.

---

## Technical Context

**Language/Version**: TypeScript 5.x, Node.js 20+  
**Primary Dependencies**: Next.js 16.x, React 19, xlsx (SheetJS), pdf-lib  
**Storage**: Neon PostgreSQL via Drizzle ORM (for Flight entity), Vercel Blob (for generated PDFs)  
**Testing**: Vitest for unit tests, Playwright for E2E  
**Target Platform**: Web (Desktop primary, mobile responsive)  
**Project Type**: Web application (Next.js App Router)  
**Performance Goals**: Import 869 flights < 30s, PDF generation (49 pages) < 60s  
**Constraints**: File upload < 10MB, UI must remain responsive during processing  
**Scale/Scope**: Single user MVP, 1000+ flights supported

---

## Constitution Check

*GATE: Must pass before Phase 0 research. Re-check after Phase 1 design.*

| Principle | Status | Notes |
|-----------|--------|-------|
| I. TCCA Compliance First | PASS | PDF output mirrors official TCCA format |
| II. Lossless Import | PASS | All 35 columns mapped, validation errors surfaced |
| III. Calculation Accuracy | PASS | Page totals and running totals computed per spec |
| IV. Fast Entry | N/A | This feature is import, not manual entry |
| V. PDF Visual Fidelity | PASS | 18 rows/page, page totals, totals forwarded, totals to date |

---

## Project Structure

### Documentation (this feature)

```text
spec-commands/.specify/specs/excel-to-pdf-import/
├── plan.md              # This file
├── research.md          # Phase 0 output - technology decisions
├── data-model.md        # Phase 1 output - Flight entity schema
├── quickstart.md        # Phase 1 output - developer setup
└── contracts/           # Phase 1 output - API contracts
    ├── upload.ts        # Upload endpoint types
    ├── preview.ts       # Preview endpoint types
    └── export.ts        # PDF export endpoint types
```

### Source Code (repository root)

```text
app/
├── import/
│   ├── page.tsx              # Import wizard UI
│   ├── components/
│   │   ├── FileUploader.tsx   # Drag-and-drop upload zone
│   │   ├── PreviewTable.tsx   # Flight data preview table
│   │   ├── ValidationBanner.tsx # Import status/warnings
│   │   └── ProgressIndicator.tsx # PDF generation progress
│   └── actions.ts            # Server actions for import/export
├── api/
│   └── export/
│       └── pdf/
│           └── route.ts      # PDF generation API route

lib/
├── import/
│   ├── excel-parser.ts       # Excel file parsing logic
│   ├── column-mapper.ts      # Map Excel columns to Flight schema
│   └── validator.ts          # Flight data validation
├── export/
│   ├── pdf-generator.ts      # PDF generation with pdf-lib
│   ├── page-calculator.ts    # Page totals and running totals
│   └── tcca-template.ts      # TCCA logbook PDF template
└── db/
    └── schema.ts             # Add Flight entity (existing file)

components/
└── import/                   # Reusable import components
    └── index.ts
```

**Structure Decision**: Web application with Next.js App Router. Import feature lives in `app/import/` with supporting libraries in `lib/import/` and `lib/export/`.

---

## Phase Outputs

### Phase 0: Research (see research.md)
- Excel parsing: SheetJS (xlsx) for client-side parsing
- PDF generation: pdf-lib for server-side PDF creation
- File storage: Vercel Blob for temporary PDF storage

### Phase 1: Design (see data-model.md, contracts/)
- Flight entity with all 35+ time bucket fields
- ImportJob entity for tracking upload sessions
- API contracts for upload, preview, and export

### Phase 2: Tasks (see tasks.md - generated by /speckit.tasks)
- Will be generated after plan approval

---

## Complexity Tracking

> No violations to justify - design follows constitution principles.
